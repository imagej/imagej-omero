#!/bin/sh

set -e

# If OMERO_HOME is not set, then ask the current
# Python runtime for the appropriate directory.
if [ -z "$OMERO_HOME" ]
then
	export OMERO_HOME=`python -c "from omero.cli import CLI; print CLI().dir" 2>/dev/null`
	if [ -z "$OMERO_HOME" ]
	then
		echo "Could not set OMERO_HOME"
		exit 1
	fi
fi

# If OMERO_HOME does not point to a valid installation
# then abort.
if [ ! -e "$OMERO_HOME" ]
then
	echo "$OMERO_HOME does not exist!"
	exit 1
fi

export JYTHON_DIR="$(dirname "$0")"
export JYTHON_LIB=$(echo "$JYTHON_DIR/jython-standalone-"*.jar)
export OMERO_JARS="$OMERO_HOME/lib/server/*"
export IMAGEJ_JARS="$OMERO_HOME/lib/ImageJ.app/jars/*"
export IMAGEJ_PLUGINS="$OMERO_HOME/lib/ImageJ.app/plugins/*"
export CP="$JYTHON_LIB:$OMERO_JARS:$IMAGEJ_JARS:$IMAGEJ_PLUGINS:$CLASSPATH"
java -Djava.awt.headless=true \
	-Dlogback.configurationFile=$OMERO_HOME/etc/logback-cli.xml \
	-cp "$CP" org.python.util.jython $@
